---
layout: post
title: "block"
date: 2019-04-22 11:20:37 +0800
comments: true
categories: 
---
block的实现原理，对象模型<!--more-->
### 数据结构定义
从苹果的llvm[开源代码中](!http://clang.llvm.org/docs/Block-ABI-Apple.html#id2),我们可以看到block的数据结构定义如下
```javascript

struct Block_literal_1 {
   void *isa; // initialized to &_NSConcreteStackBlock or &_NSConcreteGlobalBlock
   int flags;
   int reserved;
   void (*invoke)(void *, ...);
   struct Block_descriptor_1 {
       unsigned long int reserved;         // NULL
       unsigned long int size;         // sizeof(struct Block_literal_1)
       // optional helper functions
       void (*copy_helper)(void *dst, void *src);     // IFF (1<<25)
       void (*dispose_helper)(void *src);             // IFF (1<<25)
       // required ABI.2010.3.16
       const char *signature;                         // IFF (1<<30)
   } *descriptor;
   // imported variables
};
```
